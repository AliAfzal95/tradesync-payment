<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeSync Pro - Purchase License</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üìà</span>
                <h1>TradeSync Pro</h1>
            </div>
            <p class="tagline">Professional Trade Copying Software</p>
        </header>

        <!-- Progress Steps -->
        <div class="progress-bar">
            <div class="step active">
                <div class="step-number">1</div>
                <span>Select Plan</span>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <span>Your Details</span>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <span>Payment</span>
            </div>
        </div>

        <!-- Plan Selection -->
        <main class="main-content">
            <h2 class="section-title">Choose Your License Plan</h2>
            <p class="section-subtitle">Select the subscription duration that works best for you</p>

            <div class="plans-container" id="plansContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading plans...</p>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>üîí Secure crypto payment via NOWPayments</p>
            <p class="footer-note">Pay with USDT (TRC20/BEP20) ‚Ä¢ Activation key will be sent to your email after payment confirmation</p>
        </footer>
    </div>

    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const info = await PaymentAPI.getPaymentInfo();
                console.log('API Response:', info); // Debug log
                renderPlans(info.plans);
            } catch (error) {
                console.error('Error loading plans:', error);
                document.getElementById('plansContainer').innerHTML = `
                    <div class="error-message">
                        <p>‚ùå Failed to load plans. Please refresh the page.</p>
                        <p style="font-size: 12px; color: #666;">${error.message}</p>
                    </div>
                `;
            }
        });

        function renderPlans(plans) {
            const container = document.getElementById('plansContainer');
            
            // Handle both uppercase (Days, Price) and lowercase (days, price)
            const plansHTML = plans.map((plan) => {
                const days = plan.days || plan.Days;
                const price = plan.price || plan.Price;
                const isPopular = days === 30;
                
                return `
                    <div class="plan-card ${isPopular ? 'popular' : ''}" onclick="selectPlan(${days}, ${price})">
                        ${isPopular ? '<div class="popular-badge">Most Popular</div>' : ''}
                        <div class="plan-duration">${days} Days</div>
                        <div class="plan-price">
                            <span class="currency">$</span>
                            <span class="amount">${price}</span>
                            <span class="unit">USD</span>
                        </div>
                        <div class="plan-perday">$${(price / days).toFixed(2)}/day</div>
                        <ul class="plan-features">
                            <li>‚úì Full Software Access</li>
                            <li>‚úì Unlimited Trade Copying</li>
                            <li>‚úì Email Support</li>
                            ${days >= 20 ? '<li>‚úì Priority Support</li>' : ''}
                            ${days >= 30 ? '<li>‚úì Best Value</li>' : ''}
                        </ul>
                        <button class="btn btn-primary">Select Plan</button>
                    </div>
                `;
            }).join('');

            container.innerHTML = plansHTML;
        }

        function selectPlan(days, price) {
            sessionStorage.setItem('selectedPlan', JSON.stringify({ days, price }));
            window.location.href = 'checkout.html';
        }
    </script>
</body>
</html>
